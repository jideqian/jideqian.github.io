<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="zh-CN" lang="zh-CN">
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
    <meta name="author" content="Jiye Qian" />
    <title>Git Essential</title>
    <link rel="shortcut icon" href="/favicon.ico" />
    <link href="/feed/" rel="alternate" title="Jiye Qian" type="application/atom+xml" />
    <link rel="stylesheet" href="/assets/css/style.css" />
    <link rel="stylesheet" href="/assets/css/pygments/default.css" />
    <link rel="stylesheet" href="/assets/css/coderay.css" />

    <script type="text/javascript" src="/assets/js/jquery-1.7.1.min.js"></script>
    <script type="text/javascript" src="/assets/js/outliner.js"></script>

    <!-- MathJax for LaTeX -->
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        "HTML-CSS": { extensions: ["handle-floats.js"] },
        TeX: { equationNumbers: { autoNumber: "AMS" } },
        tex2jax: {
            inlineMath: [['$$$', '$$$'], ['$', '$'], ['\\(', '\\)']],
            processEscapes: true
        }
    });
    </script>
    <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <!-- <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_SVG"></script> -->
  <script type="text/javascript">
var _bdhmProtocol = (("https:" == document.location.protocol) ? " https://" : " http://");
document.write(unescape("%3Cscript src='" + _bdhmProtocol + "hm.baidu.com/h.js%3Faa6c4cba1a96584b9d529cb356a6aef2' type='text/javascript'%3E%3C/script%3E"));
</script>


  </head>
<!--  <body>
-->
  <script type="text/javascript">
    function setTimeSpan(){
    	var date = new Date();
    	timeSpan.innerText=date.format('yyyy-MM-dd hh:mm:ss');
    }

    Date.prototype.format = function(format)
		{
    var o =
    	{
    	    "M+" : this.getMonth()+1, //month
    	    "d+" : this.getDate(),    //day
    	    "h+" : this.getHours(),   //hour
    	    "m+" : this.getMinutes(), //minute
    	    "s+" : this.getSeconds(), //second
    	    "q+" : Math.floor((this.getMonth()+3)/3),  //quarter
    	    "S" : this.getMilliseconds() //millisecond
    	}
    	if(/(y+)/.test(format))
    	format=format.replace(RegExp.$1,(this.getFullYear()+"").substr(4 - RegExp.$1.length));
    	for(var k in o)
    	if(new RegExp("("+ k +")").test(format))
    	format = format.replace(RegExp.$1,RegExp.$1.length==1 ? o[k] : ("00"+ o[k]).substr((""+ o[k]).length));
    	return format;
		}
  </script>
  <body onLoad="setInterval(setTimeSpan,1000);">
    <div id="container">
      <div id="main" role="main">
        <header>
        <h1>Git Essential</h1>
        </header>
        <nav id="real_nav">
        <span><a title="home" class="" href="/">home</a></span>
        <span><a title="categories" class="" href="/categories/">categories</a></span>
        <span><a title="tags" class="" href="/tags/">tags</a></span>
        <span><a title="logs" class="" href="/logs/">Log</a></span>
        <span><a title="about" class="" href="/about/">about</a></span>
        <span><a title="subscribe by RSS" class="" href="/feed/">Subscribe</a></span>
        </nav>
        <article class="content">
        <section class="meta">
<span class="time">
  <time datetime="2011-09-27">2011-09-27</time>
</span>

 |
<span class="categories">
  categories
  
  <a href="/categories/#振导社会" title="振导社会">振导社会</a>&nbsp;
  
</span>


 |
<span class="tags">
  tags
  
  <a href="/tags/#程序设计" title="程序设计">程序设计</a>&nbsp;
  
  <a href="/tags/#Git" title="Git">Git</a>&nbsp;
  
  <a href="/tags/#工具" title="工具">工具</a>&nbsp;
  
</span>

</section>
<section class="post">
<h2 id="git-">git 代码库的结构</h2>
<p><img src="../../../assets/images/2012-06-27-git-transport.png" alt="git代码库结构" /></p>

<p>上图展示了git代码仓库的结构以及执行相关命令后数据的变迁流程。git 维护的代码分成三部分：current working directory（当前工作目录）、index file、git repository（git仓库）。</p>

<ul>
  <li>git add 会将“当前工作目录”的改变写到“index file”；</li>
  <li>git commit 会将“index file”中的改变写到git仓库；</li>
  <li>git commit -a 则会直接将“当前工作目录”的改动同时写到“index file”和“git仓库”。</li>
</ul>

<p>将“当前工作目录”记为 (1)，将 index file 记为 (2)，将“git仓库”记为 (3)。他们之间的提交层次关系是 (1) -&gt; (2) -&gt; (3)，从时间上看，可以认为(1)是最新的代码，(2)比较旧，(3)更旧。三者之间的数据变化：
<!--more-->
- git add 完成的是(1) -&gt; (2)；
- git commit 完成的是(2) -&gt; (3)；
- git commit -a 两者的直接结合。  </p>

<p>查看三者之间的变化：</p>

<ul>
  <li>git diff 得到的是从(2)到(1)的变化</li>
  <li>git diff –cached 得到的是从(3)到(2)的变化</li>
  <li>git diff HEAD 得到的是从(3)到(1)的变化</li>
</ul>

<p>github给出了如下图所示的<a href="http://marklodato.github.com/visual-git-guide/index-en.html">简明git可视化教程</a>。
<img src="http://marklodato.github.com/visual-git-guide/basic-usage.svg" alt="git basic usage" /></p>

<h2 id="git--1">git 中的常量</h2>

<table>
  <thead>
    <tr>
      <th style="text-align: left">常量名</th>
      <th style="text-align: left">含义</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: left">HEAD^</td>
      <td style="text-align: left">最近一次的commit</td>
    </tr>
    <tr>
      <td style="text-align: left">HEAD^^</td>
      <td style="text-align: left">HEAD父母的信息</td>
    </tr>
    <tr>
      <td style="text-align: left">HEAD~4</td>
      <td style="text-align: left">HEAD父母的父母的信息</td>
    </tr>
    <tr>
      <td style="text-align: left">HEAD^1</td>
      <td style="text-align: left">HEAD的第一个父母的信息</td>
    </tr>
    <tr>
      <td style="text-align: left">HEAD^2</td>
      <td style="text-align: left">HEAD的第二个父母的信息</td>
    </tr>
    <tr>
      <td style="text-align: left">COMMIT_EDITMSG</td>
      <td style="text-align: left">最后一次commit时的提交信息</td>
    </tr>
    <tr>
      <td style="text-align: left">MERGE_HEAD</td>
      <td style="text-align: left">如果是merge产生的commit，那么它表示除HEAD之外的另一个父母分支。</td>
    </tr>
    <tr>
      <td style="text-align: left">FETCH_HEAD</td>
      <td style="text-align: left">使用git-fetch获得的object和ref的信息都存储在这里，这些信息是为日后git-merge准备的。</td>
    </tr>
  </tbody>
</table>

<h2 id="git--2">git 的基本命令</h2>

<table>
  <thead>
    <tr>
      <th style="text-align: left">基本命令</th>
      <th style="text-align: left">含义</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: left">git help command</td>
      <td style="text-align: left">查看帮助</td>
    </tr>
    <tr>
      <td style="text-align: left">git command –help</td>
      <td style="text-align: left">查看帮助</td>
    </tr>
    <tr>
      <td style="text-align: left">git config –global user.name &lt;username&gt;</td>
      <td style="text-align: left">设置用户名</td>
    </tr>
    <tr>
      <td style="text-align: left">git config –global user.email &lt;email&gt;</td>
      <td style="text-align: left">设置用户邮箱</td>
    </tr>
    <tr>
      <td style="text-align: left">git config –list</td>
      <td style="text-align: left">查看用户信息</td>
    </tr>
    <tr>
      <td style="text-align: left">git init</td>
      <td style="text-align: left">初始化</td>
    </tr>
    <tr>
      <td style="text-align: left">git clone /path/to/repository</td>
      <td style="text-align: left">创建一个本地仓库的克隆</td>
    </tr>
    <tr>
      <td style="text-align: left"><span style="white-space:nowrap">git clone username@host:/path/to/repository</span></td>
      <td style="text-align: left">创建一个远端服务器仓库的克隆</td>
    </tr>
    <tr>
      <td style="text-align: left">git add &lt;filename&gt;</td>
      <td style="text-align: left">将改动添加到缓存区</td>
    </tr>
    <tr>
      <td style="text-align: left">git add *</td>
      <td style="text-align: left">将改动添加到缓存区</td>
    </tr>
    <tr>
      <td style="text-align: left">git commit -m “代码提交信息”</td>
      <td style="text-align: left">提交改动</td>
    </tr>
    <tr>
      <td style="text-align: left">git commit –amend -m “新的提交信息”</td>
      <td style="text-align: left">提交改动（若有改动） + 修补最近一次提交</td>
    </tr>
    <tr>
      <td style="text-align: left">git push origin master</td>
      <td style="text-align: left">这些改动提交到远端仓库master分支</td>
    </tr>
    <tr>
      <td style="text-align: left">git remote add origin &lt;server&gt;</td>
      <td style="text-align: left">修改推送到远程的服务器</td>
    </tr>
    <tr>
      <td style="text-align: left">git checkout -b feature_x</td>
      <td style="text-align: left">创建一个叫做“feature_x”的分支，并切换过去</td>
    </tr>
    <tr>
      <td style="text-align: left">git checkout master</td>
      <td style="text-align: left">切换回主分支</td>
    </tr>
    <tr>
      <td style="text-align: left">git branch -d feature_x</td>
      <td style="text-align: left">删除分支</td>
    </tr>
    <tr>
      <td style="text-align: left">git pull</td>
      <td style="text-align: left">更新本地仓库至最新</td>
    </tr>
    <tr>
      <td style="text-align: left">git merge &lt;branch&gt;</td>
      <td style="text-align: left">合并其他分支到当前分支</td>
    </tr>
    <tr>
      <td style="text-align: left">git diff &lt;source_branch&gt; &lt;target_branch&gt;</td>
      <td style="text-align: left">查看分支间差异</td>
    </tr>
    <tr>
      <td style="text-align: left">git log</td>
      <td style="text-align: left">获取提交 ID</td>
    </tr>
    <tr>
      <td style="text-align: left">git tag 1.0.0 &lt;ID&gt;</td>
      <td style="text-align: left">创建一个叫做 1.0.0 的标签</td>
    </tr>
    <tr>
      <td style="text-align: left">git checkout – &lt;filename&gt;</td>
      <td style="text-align: left">用git仓库的HEAD替换当前工作目录的改动</td>
    </tr>
  </tbody>
</table>

<hr />

<table>
  <thead>
    <tr>
      <th style="text-align: left">git add 命令</th>
      <th style="text-align: left">含义</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: left">git add file_name</td>
      <td style="text-align: left">加单个文件</td>
    </tr>
    <tr>
      <td style="text-align: left">git add .</td>
      <td style="text-align: left">加当前目录的所有文件</td>
    </tr>
    <tr>
      <td style="text-align: left">git add -i</td>
      <td style="text-align: left">进入交互式add</td>
    </tr>
    <tr>
      <td style="text-align: left">git add -p</td>
      <td style="text-align: left">直接进入补丁模式，可以暂存修改的一部分。</td>
    </tr>
  </tbody>
</table>

<table>
  <thead>
    <tr>
      <th style="text-align: left"><span style="white-space:nowrap">git commit 命令</span></th>
      <th style="text-align: left">含义</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: left"><span style="white-space:nowrap">git commit -a</span></td>
      <td style="text-align: left">第一步：自动地add所有改动的代码，使得所有的开发代码都列于index file中；第二步：自动地删除那些在index file中但不在工作树中的文件；第三步：执行commit命令来提交。</td>
    </tr>
  </tbody>
</table>

<table>
  <thead>
    <tr>
      <th style="text-align: left">git push 命令</th>
      <th style="text-align: left">含义</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: left">git push origin test:test2</td>
      <td style="text-align: left">提交本地test分支作为远程test2分支</td>
    </tr>
    <tr>
      <td style="text-align: left">git push origin test</td>
      <td style="text-align: left">提交本地test分支作为远程test分支</td>
    </tr>
    <tr>
      <td style="text-align: left">git push origin :test</td>
      <td style="text-align: left">删除远程test分支</td>
    </tr>
    <tr>
      <td style="text-align: left">git push origin :refs/tags/t4</td>
      <td style="text-align: left">删除远程tag标签t4</td>
    </tr>
  </tbody>
</table>

<table>
  <thead>
    <tr>
      <th style="text-align: left">git pull 命令</th>
      <th style="text-align: left">含义</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: left">git pull origin test:test2</td>
      <td style="text-align: left">取回远程的test分支作为本地的test2分支</td>
    </tr>
  </tbody>
</table>

<table>
  <thead>
    <tr>
      <th style="text-align: left">git checkout 命令</th>
      <th style="text-align: left">含义</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: left">git checkout test</td>
      <td style="text-align: left">如果本地无test分支，先需要从远程pull回test分支</td>
    </tr>
  </tbody>
</table>

<table>
  <thead>
    <tr>
      <th style="text-align: left">git branch 命令</th>
      <th style="text-align: left">含义</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: left">git branch b4 t4</td>
      <td style="text-align: left">以tag t4建立新的分支b4</td>
    </tr>
  </tbody>
</table>

<table>
  <thead>
    <tr>
      <th style="text-align: left">git merge 命令</th>
      <th style="text-align: left">含义</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: left">git merge AAA</td>
      <td style="text-align: left">将分支AAA与当前分枝合并</td>
    </tr>
  </tbody>
</table>

<table>
  <thead>
    <tr>
      <th style="text-align: left">git diff 命令</th>
      <th style="text-align: left">含义</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: left">git diff </td>
      <td style="text-align: left">查看working tree与index file的差别的（这个命令只在git add之前使用有效。如果已经add了，那么此命令输出为空）。</td>
    </tr>
    <tr>
      <td style="text-align: left"><span style="white-space:nowrap">git diff –cached</span></td>
      <td style="text-align: left">查看index file与commit的差别的（这个命令在git add之后在git commit之前有效。）。</td>
    </tr>
    <tr>
      <td style="text-align: left">git diff HEAD</td>
      <td style="text-align: left">查看working tree和commit的差别的。（你一定没有忘记，HEAD代表的是最近的一次commit的信息）</td>
    </tr>
  </tbody>
</table>

<table>
  <thead>
    <tr>
      <th style="text-align: left">git reset 命令</th>
      <th style="text-align: left">含义</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: left">git reset –soft</td>
      <td style="text-align: left">只撤销commit，保留working tree和index file。</td>
    </tr>
    <tr>
      <td style="text-align: left"><span style="white-space:nowrap">git reset –mixed</span></td>
      <td style="text-align: left">撤销commit和index file，保留working tree</td>
    </tr>
    <tr>
      <td style="text-align: left">git reset –hard</td>
      <td style="text-align: left">撤销commit、index file和working tree，即撤销销毁最近一次的commit</td>
    </tr>
    <tr>
      <td style="text-align: left">git reset</td>
      <td style="text-align: left">和git reset –mixed完全一样</td>
    </tr>
    <tr>
      <td style="text-align: left">git reset –</td>
      <td style="text-align: left">用于删除登记在index file里的某个文件。例如：git reset – roc.c</td>
    </tr>
  </tbody>
</table>

<table>
  <thead>
    <tr>
      <th style="text-align: left">git revert 命令</th>
      <th style="text-align: left">含义</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: left">git revert</td>
      <td style="text-align: left">用于回滚（撤销）一些commit。对于一个或者多个已经存在的commit，去除由这些commit引入的改变，并且用一个新的commit来记录这个回滚操作。这个命令要求working tree必须是干净的。</td>
    </tr>
    <tr>
      <td style="text-align: left">git revert HEAD~3</td>
      <td style="text-align: left">丢弃最近的三个commit，把状态恢复到最近的第四个commit，并且提交一个新的commit来记录这次改变。</td>
    </tr>
    <tr>
      <td style="text-align: left"><span style="white-space:nowrap">git revert -n master~5..master~2</span></td>
      <td style="text-align: left">丢弃从最近的第五个commit（包含）到第二个（不包含）,但是不自动生成commit，这个revert仅仅修改working tree和index。</td>
    </tr>
  </tbody>
</table>

<table>
  <thead>
    <tr>
      <th style="text-align: left">其它命令</th>
      <th style="text-align: left">含义</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: left">git rebase</td>
      <td style="text-align: left"> </td>
    </tr>
    <tr>
      <td style="text-align: left">git submodule</td>
      <td style="text-align: left">（1、2）</td>
    </tr>
  </tbody>
</table>

<h2 id="section">应用实例</h2>

<h3 id="gitcommitmessage">git中修改commit的message的方法</h3>
<ul>
  <li>git rebase -i master~5 </li>
  <li>这个是找出master分支最近5次的commit，看见那个写错的了吧？把pick改成reword</li>
</ul>

<h3 id="section-1">丢弃你所有的本地改动与提交</h3>
<ul>
  <li>到服务器上获取最新的版本并将你本地主分支指向到它
    <ol>
      <li>git fetch origin</li>
      <li>git reset –hard origin/master</li>
    </ol>
  </li>
</ul>

<h2 id="section-2">参考文献</h2>
<p><a href="http://marklodato.github.com/visual-git-guide/index-en.html">A Visual Git Reference</a> <br />
<a href="http://robbinfan.com/blog/34/git-common-command">Git常用命令备忘</a> <br />
<a href="http://rogerdudler.GitHub.com/git-guide/index.zh.html">git - 简易指南</a><br />
<a href="http://roclinux.cn/?tag=git">Linux大棚的Git教程</a>     <br />
<a href="http://guibin.iteye.com/blog/1014369">GIT基本概念和用法总结</a><br />
<a href="http://www.ruanyifeng.com/blog/2012/07/git.html">Git分支管理策略</a> <br />
<a href="http://blog.longwin.com.tw/2009/05/git-learn-initial-command-2009/">Git 初學筆記 - 指令操作教學</a>  <br />
<a href="http://marklodato.github.com/visual-git-guide/index-zh-cn.html">图解Git</a>    <br />
<a href="http://www-cs-students.stanford.edu/~blynn/gitmagic/intl/zh_cn/">Git Magic</a>    <br />
<a href="http://blog.sina.com.cn/s/blog_68af3f090100rp5r.html">超级有用的git reset –hard和git revert命令</a> <br />
<a href="http://www.worldhello.net/gotgithub/index.html">GetGitHub</a>   </p>

<p><a href="http://blog.yorkxin.org/2011/07/29/git-rebase">Git-rebase 小筆記</a> <br />
<a href="http://ihower.tw/git/">版本控制系統 Git 精要</a>    <br />
<a href="http://git-scm.com/book/zh">Pro Git</a>   <br />
<a href="http://nvie.com/posts/a-successful-git-branching-model/">A successful Git branching model</a>    </p>


</section>
<section align="right">
<br/>
<span>
  <a  href="/2011/09/stories" class="pageNav"  >上一篇</a>
  &nbsp;&nbsp;&nbsp;
  <a  href="/2011/10/foreign-poems" class="pageNav"  >下一篇</a>
</span>
</section>

	
	<ul class="ds-recent-visitors"></ul>
	<div class="ds-thread" data-thread-key="/2011/09/git-essential" data-url="http://jiyeqian.bitbucket.org/2011/09/git-essential" data-title="Git Essential">
	</div>
	<script type="text/javascript">
	var first_image = document.getElementsByClassName("post")[0].getElementsByTagName("img")[0]; 
	if (first_image != undefined) {
	document.getElementsByClassName("ds-thread")[0].setAttribute("data-image", first_image.src);
	}
	</script>
		
	<script type="text/javascript">
	var duoshuoQuery = {short_name:"jiyeqian"};
	(function() {
		var ds = document.createElement('script');
		ds.type = 'text/javascript';ds.async = true;
		ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
		ds.charset = 'UTF-8';
		(document.getElementsByTagName('head')[0] 
		|| document.getElementsByTagName('body')[0]).appendChild(ds);
	})();
	</script>


<script type="text/javascript">
$(function(){
  $(document).keydown(function(e) {
    var url = false;
        if (e.which == 37 || e.which == 72) {  // Left arrow and H
        
        url = '/2011/09/stories';
        
        }
        else if (e.which == 39 || e.which == 76) {  // Right arrow and L
        
        <!-- url = 'http://jiyeqian.bitbucket.org/2011/10/foreign-poems'; -->
        url = '/2011/10/foreign-poems';
        
        } else if (e.which == 75) {  // K
          url = '#';
        } else if (e.which == 74) { // J
        url = '/2011/09/git-essential/#timeSpan';
        }
        if (url) {
            window.location = url;
        }
  });
})
</script>

        </article>
        <a style="position:fixed;bottom:5px;right:5px;" href="#" title="Back to Top">
            <img src="/assets/images/site/btt.png" />
        </a>
      </div>

    <footer>
        <p><small>
            Powered by <a href="http://jekyllrb.com" target="_blank">Jekyll</a> | Copyright 2014 - 2014 by <a href="/about/">Jiye Qian</a> | <span class="label label-info" id="timeSpan"></span></small></p>
    </footer>

    </div>
  </body>
</html>
